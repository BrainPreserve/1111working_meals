<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brain Healthy Meal Generator — Standalone</title>
  <style>
    :root{ --bg:#f7f8fb; --fg:#111; --muted:#667085; --card:#fff; --line:#e5e7eb; --accent:#0a60ff; }
    *{box-sizing:border-box}
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--fg)}
    main{max-width:980px;margin:28px auto;padding:0 16px}
    h1{margin:0 0 8px}
    h2{margin:0 0 8px}
    .subtitle{color:#475467;margin:0 0 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 4px 14px rgba(0,0,0,.04);margin:18px 0}
    textarea{width:100%;padding:12px;border:1px solid #d0d5dd;border-radius:12px}
    .row{display:flex;align-items:center;gap:10px;margin:10px 0}
    input[type="number"],
    input[type="email"]{width:220px;padding:10px;border:1px solid #d0d5dd;border-radius:12px}
    button{padding:10px 14px;border:1px solid var(--accent);background:var(--accent);color:#fff;border-radius:12px;cursor:pointer}
    button.ghost{border-color:#d0d5dd;background:#fff;color:#111}
    button:disabled{opacity:.6;cursor:not-allowed}
    .btn-row{display:flex;gap:10px;flex-wrap:wrap}
    pre{white-space:pre-wrap;background:#ffffff;color:#111111;padding:12px;border-radius:12px;min-height:48px;margin-top:12px;border:1px solid #e5e7eb}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}
    .accordion{border:1px dashed #d0d5dd;border-radius:12px;margin-top:12px}
    .acc-header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;cursor:pointer}
    .acc-header h4{margin:0}
    .acc-header span{font-size:13px;color:var(--muted)}
    .acc-content{border-top:1px dashed #d0d5dd;padding:10px 12px;display:none}
    .accordion.open .acc-content{display:block}
    .muted{color:#667085;font-size:13px}
    .checks{display:flex;flex-wrap:wrap;gap:8px}
    .check-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #d0d5dd;font-size:13px;background:#fff}
    .check-pill input{margin:0}
    .status{margin-top:8px;font-size:13px;color:var(--muted)}
    #bp-nutrition{margin:24px 0}
    .table-wrapper{margin:16px 0;border-radius:12px;border:1px solid #e5e7eb;overflow:hidden;background:#fff}
    .table-wrapper h3{margin:0;padding:10px 12px;border-bottom:1px solid #e5e7eb;background:#f9fafb}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 10px;border-bottom:1px solid #f1f5f9;text-align:left}
    th{background:#f9fafb;font-weight:600}
    tr:nth-child(even){background:#f9fafb}
    .badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;font-size:11px;border:1px solid #e5e7eb;background:#f9fafb}
    .badge.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge.caution{border-color:#ea580c;color:#9a3412;background:#ffedd5}
    .badge.limit{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill{display:inline-flex;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;font-size:11px;margin:0 4px 4px 0}
    .pill.green{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill.red{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill.neutral{border-color:#6b7280;color:#374151;background:#f9fafb}
    .note{font-size:11px;color:#6b7280;margin-top:4px}
    .section-label{font-size:12px;font-weight:600;color:#475467;text-transform:uppercase;letter-spacing:.03em;margin:0 0 4px}
    .card-title-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .card-title-row small{font-size:12px;color:#6b7280}
    .tag-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .tag{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#374151}
    .tag.anti{border-color:#16a34a;color:#166534;background:#dcfce7}
    .tag.pro{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .tag.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .tag.neuro{border-color:#4f46e5;color:#3730a3;background:#e0e7ff}
    .tag.metabolic{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .tag.microbiome{border-color:#a855f7;color:#6b21a8;background:#f3e8ff}
    .tag.cardiometabolic{border-color:#22c55e;color:#15803d;background:#dcfce7}
    .tag.cognitive{border-color:#f97316;color:#9a3412;background:#ffedd5}
    .tag.generic{border-color:#6b7280;color:#374151;background:#f9fafb}
    .footnote{font-size:11px;color:#6b7280;margin-top:8px}
    .bp-note{font-size:11px;color:#6b7280;margin-top:6px}
    .bp-section-title{font-size:14px;font-weight:600;margin:12px 0 4px}
    .pill-row{display:flex;flex-wrap:wrap;gap:6px;margin:4px 0}
    .pill-row .pill{margin:0}
    .subtle-card{border-radius:12px;border:1px dashed #e5e7eb;padding:12px;background:#f9fafb;margin-top:10px}
    .subtle-card h4{margin:0 0 4px;font-size:13px}
    .subtle-card p{margin:0;font-size:12px;color:#4b5563}
    .mini-label{font-size:11px;color:#6b7280;margin-bottom:2px}
    .legend-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .legend-row .badge{margin-right:4px}
    .small{font-size:12px;color:#6b7280}
    .section-spacer{margin-top:18px;border-top:1px dashed #e5e7eb;padding-top:12px}
    .helper-text{font-size:12px;color:#6b7280;margin-top:4px}
    .field-group{margin:8px 0}
    .field-group label{display:block;font-size:13px;color:#374151;margin-bottom:4px}
    .field-group input{width:100%;max-width:260px;padding:8px 10px;border-radius:12px;border:1px solid #d0d5dd}
    .section-caption{font-size:12px;color:#6b7280;margin-top:4px}
    .inline-pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;font-size:11px;background:#f9fafb;color:#374151;margin-left:6px}
    .info-block{font-size:12px;color:#4b5563;background:#f9fafb;border-radius:12px;padding:8px 10px;border:1px dashed #e5e7eb;margin-top:8px}
    .info-block strong{color:#111827}
    .stack{display:flex;flex-direction:column;gap:4px}
    .highlight-card{border-radius:14px;border:1px solid #e5e7eb;background:#f9fafb;padding:10px 12px;margin-top:10px}
    .highlight-card p{margin:0;font-size:12px;color:#374151}
    .highlight-card strong{color:#111827}
    .pill.accent{border-color:#0a60ff;color:#0a60ff;background:#eff4ff}
    .note-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}
    .note-row span{font-size:11px;color:#6b7280}
    .hrule{border-top:1px dashed #e5e7eb;margin:10px 0}
    .tight{margin-top:4px}
    .pill.emphasis{border-color:#4f46e5;color:#312e81;background:#e0e7ff}
    .small-muted{font-size:11px;color:#9ca3af}
    .full-width{width:100%}
    .card-footer{margin-top:10px;font-size:11px;color:#6b7280}
    .pill.subtle{border-color:#e5e7eb;color:#4b5563;background:#f9fafb}
    .bp-caption{font-size:11px;color:#6b7280;margin-top:4px}
    .pill-row-tight{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
    .pill-row-tight .pill{margin:0;font-size:10px;padding:2px 6px}
    .pill.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill.warning{border-color:#f97316;color:#9a3412;background:#ffedd5}
    .pill.strong{border-color:#4b5563;color:#111827;background:#e5e7eb}
    .pill-key{font-weight:600}
    .stack-tight{display:flex;flex-direction:column;gap:2px}
    .micro-note{font-size:11px;color:#6b7280;margin-top:2px}
    .spacer-sm{margin-top:6px}
    .card-compact{border-radius:12px;border:1px solid #e5e7eb;background:#f9fafb;padding:8px 10px;margin-top:8px}
    .card-compact p{margin:0;font-size:12px;color:#374151}
    .card-compact strong{color:#111827}
    .inline-list{display:inline-flex;flex-wrap:wrap;gap:4px}
    .inline-list span{font-size:11px;color:#4b5563}
    .pill.neutral-alt{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-row-center{display:flex;flex-wrap:wrap;gap:4px;align-items:center}
    .pill-row-center .pill{margin:0}
    .stacked-note{font-size:11px;color:#6b7280;margin-top:4px}
    .muted-inline{font-size:11px;color:#9ca3af}
    .small-strong{font-size:12px;font-weight:600;color:#111827}
    .soft-card{border-radius:12px;border:1px solid #e5e7eb;background:#f9fafb;padding:10px 12px;margin-top:10px}
    .soft-card p{margin:0;font-size:12px;color:#374151}
    .soft-card strong{color:#111827}
    .soft-card .pill{font-size:10px;padding:2px 6px}
    .pill-keyword{font-weight:500}
    .bp-subtitle{font-size:12px;color:#6b7280;margin-top:2px}
    .pill-outline{border-color:#d1d5db;color:#374151;background:#fff}
    .note-compact{font-size:11px;color:#6b7280;margin-top:2px}
    .pill-compact{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-compact.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-compact.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-compact.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
    .section-header small{font-size:11px;color:#9ca3af}
    .toggle-row{display:flex;align-items:center;gap:8px;margin-top:4px}
    .toggle-row input{margin:0}
    .toggle-row label{font-size:12px;color:#4b5563}
    .hint{font-size:11px;color:#6b7280;margin-top:2px}
    .divider{border-top:1px dashed #e5e7eb;margin:8px 0}
    .chip-row{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
    .chip{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .chip.emphasis{border-color:#4f46e5;color:#312e81;background:#e0e7ff}
    .chip.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .chip.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .chip.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .chip.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .chip.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .keyline{border-top:1px dashed #e5e7eb;margin:10px 0}
    .mini-help{font-size:11px;color:#9ca3af;margin-top:2px}
    .micro-badge{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .micro-badge.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .micro-badge.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .micro-badge.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .micro-badge.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .micro-badge.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .bp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
    .bp-header h3{margin:0;font-size:14px}
    .bp-header span{font-size:11px;color:#9ca3af}
    .pill-stack{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
    .pill-stack .pill{margin:0}
    .stack-note{font-size:11px;color:#6b7280;margin-top:4px}
    .pill-soft{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-soft.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-soft.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-soft.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-soft.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-soft.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-soft-key{font-weight:500}
    .bp-grid{display:grid;grid-template-columns:1.2fr 1.3fr;gap:12px}
    @media (max-width:860px){.bp-grid{grid-template-columns:1fr}}
    .bp-col{padding:6px 0}
    .bp-col h4{margin:0 0 4px;font-size:13px}
    .bp-col p{margin:0;font-size:12px;color:#4b5563}
    .bp-col .pill-row{margin-top:4px}
    .bp-col .note{margin-top:2px}
    .subhead{font-size:13px;color:#4b5563;margin:4px 0 0}
    .mini-pill{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .mini-pill.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .mini-pill.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .mini-pill.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .mini-pill.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .mini-pill.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .mini-note{font-size:11px;color:#6b7280;margin-top:2px}
    .card-tight{border-radius:10px;border:1px solid #e5e7eb;background:#f9fafb;padding:6px 8px;margin-top:6px}
    .card-tight p{margin:0;font-size:11px;color:#374151}
    .bp-legend{font-size:11px;color:#6b7280;margin-top:6px}
    .bp-legend span{margin-right:8px}
    .bp-legend .badge{margin-right:4px}
    .badge.small{font-size:10px;padding:1px 6px}
    .pill-extra{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-extra.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-extra.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-extra.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-extra.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-extra.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .small-caption{font-size:11px;color:#6b7280;margin-top:4px}
    .note-inline{font-size:11px;color:#9ca3af}
    .card-subtle{border-radius:12px;border:1px dashed #e5e7eb;background:#f9fafb;padding:8px 10px;margin-top:8px}
    .card-subtle p{margin:0;font-size:12px;color:#374151}
    .card-subtle strong{color:#111827}
    .badge-dot{display:inline-flex;align-items:center;gap:4px;font-size:11px;color:#6b7280}
    .badge-dot span{width:6px;height:6px;border-radius:999px;background:#6b7280;display:inline-block}
    .badge-dot.good span{background:#16a34a}
    .badge-dot.bad span{background:#b91c1c}
    .badge-dot.mixed span{background:#0f766e}
    .badge-dot.info span{background:#0ea5e9}
    .badge-dot.neutral span{background:#9ca3af}
    .bp-card{border-radius:14px;border:1px solid #e5e7eb;background:#ffffff;padding:12px 14px;margin:12px 0}
    .bp-card h3{margin:0 0 4px;font-size:15px}
    .bp-card p{margin:0;font-size:12px;color:#4b5563}
    .bp-card .pill-row{margin-top:4px}
    .bp-card .note{margin-top:4px}
    .pill-thin{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-thin.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-thin.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-thin.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-thin.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-thin.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-thin-key{font-weight:500}
    .bp-hint{font-size:11px;color:#6b7280;margin-top:4px}
    .bp-section{margin-top:14px}
    .bp-section h4{margin:0 0 4px;font-size:13px}
    .bp-section p{margin:0;font-size:12px;color:#4b5563}
    .bp-section .pill-row{margin-top:4px}
    .bp-section .note{margin-top:2px}
    .bp-section .bp-caption{margin-top:2px}
    .badge-mini{font-size:10px;padding:1px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-mini.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-mini.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-mini.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-mini.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-mini.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .note-small{font-size:11px;color:#6b7280;margin-top:2px}
    .tight-card{border-radius:10px;border:1px dashed #e5e7eb;background:#f9fafb;padding:6px 8px;margin-top:6px}
    .tight-card p{margin:0;font-size:11px;color:#374151}
    .tight-card strong{color:#111827}
    .stack-xs{display:flex;flex-direction:column;gap:2px}
    .tiny{font-size:10px;color:#9ca3af}
    .pill-label{font-size:11px;color:#4b5563}
    .legend-mini{font-size:10px;color:#9ca3af;margin-top:4px}
    .subtle-divider{border-top:1px dashed #e5e7eb;margin:8px 0}
    .tagline{font-size:12px;color:#4b5563;margin-top:2px}
    .card-highlight{border-radius:14px;border:1px solid #e5e7eb;background:#f9fafb;padding:10px 12px;margin-top:10px}
    .card-highlight p{margin:0;font-size:12px;color:#374151}
    .card-highlight strong{color:#111827}
    .badge-outline{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #d1d5db;background:#fff;color:#4b5563}
    .badge-outline.good{border-color:#16a34a;color:#166534}
    .badge-outline.bad{border-color:#b91c1c;color:#7f1d1d}
    .badge-outline.mixed{border-color:#0f766e;color:#115e59}
    .badge-outline.info{border-color:#0ea5e9;color:#0369a1}
    .badge-outline.neutral{border-color:#d1d5db;color:#374151}
    .bp-note-compact{font-size:11px;color:#6b7280;margin-top:2px}
    .pill-tiny{font-size:9px;padding:1px 5px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-tiny.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-tiny.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-tiny.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-tiny.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-tiny.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .note-micro{font-size:10px;color:#9ca3af;margin-top:2px}
    .subtle-heading{font-size:12px;color:#4b5563;margin-top:6px}
    .pill-outline-mini{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #d1d5db;background:#fff;color:#4b5563}
    .hint-micro{font-size:10px;color:#9ca3af;margin-top:2px}
    .stack-slim{display:flex;flex-direction:column;gap:1px}
    .pill-neutral-soft{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .mini-divider{border-top:1px dashed #e5e7eb;margin:6px 0}
    .badge-soft{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-soft.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-soft.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-soft.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-soft.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-soft.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .badge-soft-key{font-weight:500}
    .accent-note{font-size:11px;color:#0a60ff;margin-top:2px}
    .small-inline{font-size:11px;color:#6b7280}
    .pill-small{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-small.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-small.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-small.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-small.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-small.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-small-key{font-weight:500}
    .bp-mini-caption{font-size:10px;color:#9ca3af;margin-top:2px}
    .note-fine{font-size:10px;color:#9ca3af;margin-top:2px}
    .badge-faint{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-faint.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-faint.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-faint.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-faint.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-faint.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .tiny-caption{font-size:10px;color:#9ca3af;margin-top:2px}
    .micro-p{font-size:10px;color:#9ca3af;margin-top:2px}
    .card-soft{border-radius:12px;border:1px solid #e5e7eb;background:#f9fafb;padding:8px 10px;margin-top:8px}
    .card-soft p{margin:0;font-size:12px;color:#374151}
    .card-soft strong{color:#111827}
    .pill-balanced{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-balanced.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-balanced.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-balanced.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-balanced.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-balanced.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-balanced-key{font-weight:500}
    .note-balanced{font-size:11px;color:#6b7280;margin-top:2px}
    .tag-balanced{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .tag-balanced.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .tag-balanced.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .tag-balanced.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .tag-balanced.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .tag-balanced.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .legend-balanced{font-size:11px;color:#6b7280;margin-top:4px}
    .legend-balanced span{margin-right:8px}
    .legend-balanced .badge{margin-right:4px}
    .bp-footer-note{font-size:11px;color:#6b7280;margin-top:6px}
    .pill-em{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #4f46e5;background:#e0e7ff;color:#312e81}
    .pill-em-key{font-weight:600}
    .bp-aux-note{font-size:11px;color:#6b7280;margin-top:4px}
    .stack-spaced{display:flex;flex-direction:column;gap:4px}
    .inline-help{font-size:11px;color:#6b7280;margin-left:6px}
    .wrap-note{font-size:11px;color:#6b7280;margin-top:4px}
    .bp-compact{border-radius:12px;border:1px solid #e5e7eb;background:#ffffff;padding:8px 10px;margin-top:8px}
    .bp-compact p{margin:0;font-size:12px;color:#374151}
    .bp-compact .pill-row{margin-top:4px}
    .bp-compact .note{margin-top:2px}
    .pill-trend{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-trend.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-trend.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-trend.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-trend.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-trend.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .trend-note{font-size:11px;color:#6b7280;margin-top:2px}
    .bp-subtle{font-size:11px;color:#6b7280;margin-top:4px}
    .pill-mini-alt{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #d1d5db;background:#fff;color:#4b5563}
    .tag-soft{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .tag-soft.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .tag-soft.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .tag-soft.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .tag-soft.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .tag-soft.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .note-soft{font-size:11px;color:#6b7280;margin-top:4px}
    .section-hint{font-size:11px;color:#6b7280;margin-top:2px}
    .card-slim{border-radius:12px;border:1px solid #e5e7eb;background:#f9fafb;padding:8px 10px;margin-top:8px}
    .card-slim p{margin:0;font-size:12px;color:#374151}
    .card-slim strong{color:#111827}
    .pill-slim{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-slim.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-slim.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-slim.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-slim.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-slim.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-slim-key{font-weight:500}
    .note-slim{font-size:11px;color:#6b7280;margin-top:2px}
    .pill-label-mini{font-size:10px;color:#6b7280}
    .badge-slim{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-slim.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-slim.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-slim.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-slim.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-slim.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .hint-slim{font-size:11px;color:#6b7280;margin-top:2px}
    .card-mini{border-radius:10px;border:1px solid #e5e7eb;background:#f9fafb;padding:6px 8px;margin-top:6px}
    .card-mini p{margin:0;font-size:11px;color:#374151}
    .card-mini strong{color:#111827}
    .micro-hint{font-size:10px;color:#9ca3af;margin-top:2px}
    .mini-stack{display:flex;flex-direction:column;gap:2px}
    .pill-micro{font-size:9px;padding:1px 5px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-micro.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-micro.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-micro.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-micro.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-micro.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .note-micro-alt{font-size:10px;color:#9ca3af;margin-top:2px}
    .info-mini{font-size:10px;color:#6b7280;margin-top:2px}
    .card-outline{border-radius:12px;border:1px dashed #e5e7eb;background:#f9fafb;padding:8px 10px;margin-top:8px}
    .card-outline p{margin:0;font-size:12px;color:#374151}
    .card-outline strong{color:#111827}
    .pill-outline-soft{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #d1d5db;background:#fff;color:#4b5563}
    .pill-outline-soft.good{border-color:#16a34a;color:#166534}
    .pill-outline-soft.bad{border-color:#b91c1c;color:#7f1d1d}
    .pill-outline-soft.mixed{border-color:#0f766e;color:#115e59}
    .pill-outline-soft.info{border-color:#0ea5e9;color:#0369a1}
    .pill-outline-soft.neutral{border-color:#d1d5db;color:#374151}
    .note-outline{font-size:11px;color:#6b7280;margin-top:2px}
    .badge-inline{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-inline.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-inline.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-inline.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-inline.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-inline.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .mini-help-inline{font-size:10px;color:#9ca3af;margin-left:4px}
    .note-inline-alt{font-size:10px;color:#9ca3af;margin-top:2px}
    .card-borderless{border-radius:12px;border:1px solid #e5e7eb;background:#ffffff;padding:8px 10px;margin-top:8px}
    .card-borderless p{margin:0;font-size:12px;color:#374151}
    .card-borderless strong{color:#111827}
    .divider-soft{border-top:1px dashed #e5e7eb;margin:8px 0}
    .micro-text{font-size:10px;color:#9ca3af;margin-top:2px}
    .mini-label-alt{font-size:11px;color:#6b7280}
    .stack-mini{display:flex;flex-direction:column;gap:2px}
    .card-note{font-size:11px;color:#6b7280;margin-top:4px}
    .hint-inline{font-size:11px;color:#6b7280;margin-left:6px}
    .pill-tiny-alt{font-size:9px;padding:1px 5px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-micro{font-size:9px;padding:1px 5px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-micro.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-micro.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-micro.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-micro.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-micro.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .note-micro-inline{font-size:10px;color:#9ca3af;margin-left:4px}
    .hint-micro-inline{font-size:10px;color:#9ca3af;margin-top:2px}
    .card-aux{border-radius:12px;border:1px dashed #e5e7eb;background:#f9fafb;padding:8px 10px;margin-top:8px}
    .card-aux p{margin:0;font-size:12px;color:#374151}
    .card-aux strong{color:#111827}
    .badge-aux{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .badge-aux.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .badge-aux.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .badge-aux.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .badge-aux.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .badge-aux.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .note-aux{font-size:11px;color:#6b7280;margin-top:2px}
    .bp-mini-hint{font-size:10px;color:#9ca3af;margin-top:2px}
    .stack-aux{display:flex;flex-direction:column;gap:3px}
    .pill-aux{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .pill-aux.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .pill-aux.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .pill-aux.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .pill-aux.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .pill-aux.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .pill-aux-key{font-weight:500}
    .note-aux-inline{font-size:10px;color:#9ca3af;margin-left:4px}
    .hint-aux{font-size:11px;color:#6b7280;margin-top:2px}
    .aux-caption{font-size:11px;color:#6b7280;margin-top:4px}
    .mini-hint-alt{font-size:10px;color:#9ca3af;margin-top:2px}
    .inline-aux{font-size:11px;color:#6b7280;margin-left:6px}
    .aux-divider{border-top:1px dashed #e5e7eb;margin:8px 0}
    .bp-tag{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .bp-tag.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .bp-tag.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .bp-tag.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .bp-tag.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .bp-tag.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .bp-tag-key{font-weight:500}
    .bp-note-inline{font-size:11px;color:#6b7280;margin-left:6px}
    .bp-hairline{border-top:1px dashed #e5e7eb;margin:6px 0}
    .mini-subhead{font-size:12px;color:#4b5563;margin-top:4px}
    .micro-inline{font-size:10px;color:#9ca3af;margin-left:4px}
    .aux-pill{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#4b5563}
    .aux-pill.good{border-color:#16a34a;color:#166534;background:#dcfce7}
    .aux-pill.bad{border-color:#b91c1c;color:#7f1d1d;background:#fee2e2}
    .aux-pill.mixed{border-color:#0f766e;color:#115e59;background:#ccfbf1}
    .aux-pill.info{border-color:#0ea5e9;color:#0369a1;background:#e0f2fe}
    .aux-pill.neutral{border-color:#d1d5db;color:#374151;background:#f9fafb}
    .aux-pill-key{font-weight:500}
    .aux-note{font-size:11px;color:#6b7280;margin-top:2px}
    .aux-note-inline{font-size:10px;color:#9ca3af;margin-left:4px}
    .aux-hint{font-size:11px;color:#6b7280;margin-top:2px}
    .aux-caption-inline{font-size:10px;color:#9ca3af;margin-left:4px}
    .aux-legend{font-size:11px;color:#6b7280;margin-top:4px}
    .aux-legend span{margin-right:8px}
    .aux-legend .badge{margin-right:4px}
    .card-mini-alt{border-radius:10px;border:1px solid #e5e7eb;background:#f9fafb;padding:6px 8px;margin-top:6px}
    .card-mini-alt p{margin:0;font-size:11px;color:#374151}
    .card-mini-alt strong{color:#111827}
    .aux-footnote{font-size:10px;color:#9ca3af;margin-top:2px}
    .subtle-border{border-radius:8px;border:1px dashed #e5e7eb;padding:6px 8px;margin-top:6px}
  </style>
</head>
<body>
  <main>
    <h1>Brain Healthy Meal Generator</h1>
    <p class="subtitle">Choose ingredients, set goals, or type a custom request.</p>

    <!-- Client ID + Biomarker Tracking -->
    <section class="card">
      <h2>Record &amp; Track Your Biomarkers</h2>
      <div class="row">
        <label for="client-id-input">Client ID</label>
        <input id="client-id-input" type="email" placeholder="Your Email" />
      </div>
      <p>You can record and track your biomarkers which reflect your meal choices, and your potential risk of cognitive decline.</p>
      <div class="btn-row">
        <button type="button" onclick="window.open('https://script.google.com/macros/s/AKfycbzamJjceH6M_fKDYlw78mOPIdljbuaItXrIofizd2JBlvIyprHcr0ZG5pe1-_TedyPo/exec', '_blank')">
          Click to record your biomarkers
        </button>
      </div>
    </section>

    <!-- A) Custom Request -->
    <section class="card">
      <h2>Custom Request</h2>
      <p>Example: “Make a dinner with salmon and legumes.” If you leave this empty, you can still generate recipes based on the selections and goals below. Leave the number blank to default to 3–5 recipes.</p>
      <textarea id="custom-input" rows="4" placeholder="Describe the meal(s) you want..."></textarea>
      <div class="row">
        <label for="num-recipes">Number of recipes (optional):</label>
        <input id="num-recipes" type="number" min="1" max="10" placeholder="3–5" />
      </div>
      <div class="btn-row">
        <button onclick="generateFromCustom()">Generate Recipes</button>
        <button class="ghost" type="button" onclick="clearCustomSection()">Clear Custom</button>
      </div>
      <pre id="custom-output"></pre>
    </section>

    <!-- B) Build From Ingredients -->
    <section class="card">
      <h2>Build From Ingredients</h2>
      <p>Select ingredients to include and categories to exclude. Your selections preview below.</p>

      <div class="grid">
        <div>
          <h3>Include Ingredients</h3>
          <div id="include-root"></div>
        </div>

        <div>
          <div class="accordion" id="exclude-accordion">
            <div class="acc-header" role="button" tabindex="0" aria-expanded="false" onclick="toggleAccordion(this)">
              <h4>Exclude Categories</h4>
              <span class="muted">Click to expand</span>
            </div>
            <div class="acc-content">
              <p class="muted">Check entire categories to exclude them (e.g., “Dairy”).</p>
              <div class="checks" id="exc-categories"></div>
            </div>
          </div>

          <div class="accordion" id="goals-accordion" style="margin-top:12px">
            <div class="acc-header" role="button" tabindex="0" aria-expanded="false" onclick="toggleAccordion(this)">
              <h4>Goals &amp; Emphasis</h4>
              <span class="muted">Click to expand</span>
            </div>
            <div class="acc-content">
              <p class="muted">Select one or more goals to tailor coaching suggestions.</p>
              <div class="checks" id="goals"></div>
            </div>
          </div>
        </div>
      </div>

      <h3>Preview</h3>
      <pre id="form-preview">No selections yet.</pre>

      <div class="btn-row">
        <button onclick="generateFromSelections()">Generate Recipes from Selections</button>
        <button class="ghost" type="button" onclick="clearFormSelections()">Clear Form</button>
      </div>

      <div id="status" class="status"></div>
    </section>

    <!-- Where the four nutrition tables will appear -->
    <div id="bp-nutrition"></div>
  </main>

  <!-- CSV parser and the BrainPreserve tables module -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="/assets/nutrition-tables.js"></script>

  <script>
    // =========================
    // BASIC CONFIG (endpoint only)
    // =========================
    const CFG = {
      generateEndpoint: '/.netlify/functions/generate'
    };

    // =========================
    // STATIC UI SOURCES
    // =========================
    const STARTER_INGREDIENTS = {
      "Vegetables": ["GPT CHOOSES VEGETABLES","Arugula","Collard Greens","Bok Choy","Broccoli","Brussels Sprouts","Cabbage (Green)","Cabbage (Red)","Carrots","Cauliflower","Celery","Chard","Chicory Greens","Dandelion Greens","Endive","Fennel Bulb","Kale","Kohlrabi","Leeks","Lettuce (Butter)","Lettuce (Green Leaf)","Lettuce (Red Leaf)","Lettuce (Romaine)","Mixed Greens (Spring Mix)","Mustard Greens","Okra","Onions (Red)","Onions (Yellow)","Onions (Sweet)","Parsley","Radicchio","Radishes","Scallions","Spinach","Turnip Greens","Watercress","Zucchini","Bell Peppers (Red)","Bell Peppers (Yellow)","Bell Peppers (Green)","Beets","Butternut Squash","Acorn Squash","Spaghetti Squash","Pumpkin (Fresh or Puree)","Sweet Potatoes","Yams","Cherry Tomatoes","Grape Tomatoes","Heirloom Tomatoes","Roma Tomatoes","Plum Tomatoes","Tomatillos","Portobello Mushrooms","Cremini Mushrooms","Shiitake Mushrooms","Oyster Mushrooms","Enoki Mushrooms","White Button Mushrooms","Asparagus","Artichokes","Green Beans","Snow Peas","Sugar Snap Peas","Pea Shoots","Cucumber","Summer Squash","Yellow Squash","Daikon Radish","Jicama","Napa Cabbage","Sauerkraut (Raw, Unpasteurized)","Kimchi (Low-Sodium)","Fermented Pickles (No Sugar Added)","Seaweed (Nori)","Seaweed (Wakame)","Seaweed (Dulse)","Broccoli Rabe","Chinese Broccoli (Gai Lan)","Chayote Squash","Hearts of Palm","Jerusalem Artichoke (Sunchoke)","Rutabaga","Parsnips","Turnips","Taro Root","Cassava (Yuca, in moderation)","Lotus Root","Pumpkin Seeds (as vegetable topping)","Carrot Tops (Greens)","Beet Greens","Celery Root (Celeriac)","Spirulina (Culinary Use)"],
      "Legumes": ["GPT CHOOSES LEGUMES","Chickpeas","Edamame","Green Lentils","Red Lentils","Brown Lentils","Black Lentils (Beluga)","Split Peas (Green)","Split Peas (Yellow)","Black Beans","Cannellini Beans","Great Northern Beans","Lima Beans","Fava Beans","Adzuki Beans","Black-Eyed Peas","Butter Beans","Cranberry Beans (Borlotti)","Navy Beans","Pinto Beans","Kidney Beans","Mung Beans","Soybeans (Cooked)","Tempeh (Fermented Soy)","Natto (Fermented Soy)","Peas (Green)","Peas (Snow)","Peanut (Legume, unsalted, dry-roasted)","Lupini Beans","French Lentils (Puy)"],
      "Fruit": ["GPT CHOOSES FRUIT","Apples","Avocados","Blackberries","Blueberries","Raspberries","Strawberries","Cherries (Fresh, Sweet or Tart)","Grapes (Red or Black)","Kiwi","Oranges","Clementines","Tangerines","Mandarins","Grapefruit (if not on interacting meds)","Lemons","Limes","Pears","Plums","Peaches","Nectarines","Apricots","Pineapple (Fresh)","Mango","Papaya","Pomegranate Arils","Bananas (Slightly Green for Lower GI)","Cranberries (Fresh or Unsweetened)","Goji Berries (Unsweetened, Dried)","Figs (Fresh)","Dates (Medjool, in moderation)","Passion Fruit","Dragon Fruit (Pitaya)","Guava","Starfruit (if no kidney dysfunction)"],
      "Fish": ["GPT CHOOSES FISH","Wild Salmon","Sardines (Water, No Added Salt)","Mackerel (Atlantic or Pacific, Not King)","Herring","Anchovies","Arctic Char","Rainbow Trout","Cod","Haddock","Pollock","Halibut (In Moderation, For Variety)","Sablefish (Black Cod)","Albacore Tuna (Light, Low-Mercury Options; Limited Frequency)","Barramundi","Tilapia (Responsibly Farmed, Occasional)","Mussels","Clams","Oysters","Scallops","Shrimp (Sustainably Sourced, Occasional)","Lobster (Occasional, Mindful of Saturated Fat)","Crab"],
      "Whole Grains": ["GPT CHOOSES WHOLE GRAINS","Steel-Cut Oats","Rolled Oats (Old Fashioned)","Oat Groats","Quinoa (White, Red, or Black)","Farro","Freekeh","Barley (Hulled)","Brown Rice (Short or Medium Grain)","Wild Rice","Black Rice (Forbidden Rice)","Red Rice","Buckwheat Groats (Kasha)","Amaranth","Millet","Sorghum","Teff","Bulgur Wheat","Rye Berries","Spelt Berries","Whole Wheat Berries","Einkorn Berries","100% Whole Grain Sprouted Bread (No Added Sugar, Minimal Additives)","Sourdough Bread (Whole Grain, Long-Ferment)","100% Whole Grain Pasta (Durum or Legume-Based)","Brown Rice Noodles (Minimal Additives)","Heirloom Corn (On the Cob)","Hominy (Minimal Processing)","Polenta (From Whole Grain Cornmeal, Cooled & Grilled/Baked)"],
      "Nuts & Seeds": ["GPT CHOOSES NUTS & SEEDS","Almonds (Raw or Dry-Roasted, Unsalted)","Walnuts","Pecans","Pistachios","Cashews (In Moderation)","Macadamia Nuts (In Moderation)","Hazelnuts","Brazil Nuts (1–2 Per Day for Selenium)","Pine Nuts","Peanuts (Dry-Roasted, Unsalted)","Pumpkin Seeds (Pepitas, Unsalted)","Sunflower Seeds (Unsalted)","Chia Seeds","Flaxseeds (Ground)","Hemp Seeds","Sesame Seeds","Tahini (Sesame Seed Paste, Minimal Additives)","Nut & Seed Butters (No Added Sugar or Hydrogenated Oils)","Mixed Nuts (Unsalted, No Candy Additions)"],
      "Meat & Poultry": ["GPT CHOOSES MEAT & POULTRY","Skinless Chicken Breast","Skinless Chicken Thighs (Baked/Grilled)","Turkey Breast","Ground Turkey (Lean, 93% or Higher)","Ground Chicken (Lean)","Pasture-Raised Poultry (When Accessible)","Grass-Fed Beef (Extra Lean Cuts, Limited Frequency)","Bison (Lean Cuts)","Pork Tenderloin (Trimmed, Occasional)","Lamb (Lean Cuts, Limited Frequency)","Turkey Meatballs (Oven-Baked, Lean)","Chicken Meatballs (Oven-Baked, Lean)","Extra-Lean Ground Beef (Occasional, For Iron Needs)","Game Meats (Venison, Elk - Lean, Limited)"],
      "Pasta & Starchy Sides": ["GPT CHOOSES PASTA & STARCHES","100% Whole Wheat Pasta","Lentil Pasta","Chickpea Pasta","Black Bean Pasta","Brown Rice Pasta","Soba Noodles (100% Buckwheat)","Spaghetti Squash (As Pasta Replacement)","Zucchini Noodles (Zoodles)","Barley Pilaf","Farro Pilaf","Quinoa Pilaf","Wild Rice Pilaf","Sweet Potato Mash (Olive Oil Base)","Roasted Root Vegetables (Carrots, Parsnips, Beets)","Cauliflower Mash (Olive Oil & Garlic)"],
      "Dairy & Alternatives": ["GPT CHOOSES DAIRY & ALTERNATIVES","Plain Greek Yogurt (2% or Skim, No Added Sugar)","Plain Skyr (Icelandic Yogurt)","Kefir (Plain, Unsweetened)","Cottage Cheese (Low-Fat, Low-Sodium)","Ricotta (Part-Skim, In Moderation)","Feta (Sheep or Goat, Small Amounts)","Goat Cheese (In Moderation)","Parmesan (Shaved or Grated, Small Amounts)","Part-Skim Mozzarella","Unsweetened Almond Milk (Calcium-Fortified)","Unsweetened Soy Milk (Calcium & B12-Fortified)","Unsweetened Hemp Milk","Unsweetened Oat Milk (Low-Additive Brands)","Plain Yogurt (Whole or 2%, Small Portions)"],
      "Oils & Fats": ["GPT CHOOSES OILS & FATS","Extra-Virgin Olive Oil (Primary Cooking & Dressing Fat)","Avocado Oil (High-Heat Cooking)","Olives (Green or Black, Low-Sodium, Rinsed)","Avocado (Fresh or Mashed)","Canola Oil (High-Oleic, For Certain Dishes)","Ghee (Small Amounts, For Flavor)","Grass-Fed Butter (Very Limited, Occasional)","Walnut Oil (Cold, For Dressings)","Flaxseed Oil (Cold, For Dressings Only)"],
      "Other": ["GPT CHOOSES OTHERS","Eggs (Whole, 1 Per Day Typical; Additional Whites If Needed)","Egg Whites","Hummus (Olive-Oil Based, No Seed Oils)","Salsa (Fresh, Low-Sodium)","Tomato Sauce (No Added Sugar, Low-Sodium)","Pesto (Olive Oil, Nuts, Basil)","Herbs (Fresh or Dried: Basil, Oregano, Rosemary, Thyme, Dill, Cilantro, Parsley, Mint)","Spices (Turmeric, Ginger, Cinnamon, Cumin, Coriander, Smoked Paprika, Black Pepper)","Garlic","Ginger Root (Fresh)","Lemon Juice","Lime Juice","Vinegars (Balsamic, Apple Cider, Red Wine, Rice – No Added Sugar)","Mustard (No Added Sugar)","Nutritional Yeast (B12-Fortified)","Low-Sodium Broth (Vegetable, Chicken, or Bone Broth)","Unsweetened Tea (Green, Black, Herbal)","Coffee (Filtered, In Moderation)","Dark Chocolate (70–85% Cacao, Small Squares)","Cocoa Powder (Unsweetened)","Plain Popcorn (Air-Popped, Light Olive Oil)"]
    };

    const GOALS = [
      "Support metabolic health & insulin sensitivity",
      "Lower inflammation & support brain resilience",
      "Support gut health & microbiome diversity",
      "Support blood pressure & vascular health",
      "Weight management (gentle, sustainable)",
      "Plant-forward / flexitarian emphasis",
      "High-protein, muscle-supportive pattern",
      "Support sleep & circadian stability",
      "Support cognitive performance & focus"
    ];

    const EXCLUDE_CATEGORIES = [
      "Red meat–heavy meals",
      "High-sugar desserts",
      "Refined flour–heavy meals",
      "Fried or ultra-processed patterns",
      "High-sodium patterns",
      "Full-fat dairy–heavy meals"
    ];

    // =========================
    // HELPER FUNCTIONS
    // =========================
    function createCheckboxPill(id, label, groupName) {
      const wrapper = document.createElement('label');
      wrapper.className = 'check-pill';

      const input = document.createElement('input');
      input.type = 'checkbox';
      input.value = label;
      input.name = groupName;
      input.id = id;

      const span = document.createElement('span');
      span.textContent = label;

      wrapper.appendChild(input);
      wrapper.appendChild(span);

      return wrapper;
    }

    function createIngredientSection(category, items) {
      const fragment = document.createDocumentFragment();

      const heading = document.createElement('h4');
      heading.textContent = category;
      fragment.appendChild(heading);

      const checks = document.createElement('div');
      checks.className = 'checks';

      items.forEach((item, index) => {
        const id = `${category.replace(/\s+/g, '-').toLowerCase()}-${index}`;
        const pill = createCheckboxPill(id, item, `include-${category}`);
        checks.appendChild(pill);
      });

      fragment.appendChild(checks);
      return fragment;
    }

    // ================
    // BUILD THE FORMS
    // ================
    function buildIncludeUI() {
      const root = document.getElementById('include-root');
      if (!root) return;

      Object.entries(STARTER_INGREDIENTS).forEach(([category, items]) => {
        const section = createIngredientSection(category, items);
        root.appendChild(section);
      });
    }

    function buildExcludeUI() {
      const root = document.getElementById('exc-categories');
      if (!root) return;

      EXCLUDE_CATEGORIES.forEach((label, index) => {
        const id = `exclude-${index}`;
        const pill = createCheckboxPill(id, label, 'exclude-category');
        root.appendChild(pill);
      });
    }

    function buildGoalsUI() {
      const root = document.getElementById('goals');
      if (!root) return;

      GOALS.forEach((goal, index) => {
        const id = `goal-${index}`;
        const pill = createCheckboxPill(id, goal, 'goal-tag');
        root.appendChild(pill);
      });
    }

    // ================
    // ACCORDIONS
    // ================
    function toggleAccordion(headerEl) {
      const accordion = headerEl.closest('.accordion');
      const expanded = accordion.classList.toggle('open');

      const btnHeader = accordion.querySelector('.acc-header');
      if (btnHeader) {
        btnHeader.setAttribute('aria-expanded', expanded ? 'true' : 'false');
      }
    }

    // ============
    // PREVIEW TEXT
    // ============
    function getCheckedValuesByName(name) {
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(i => i.value);
    }

    function collectFormState() {
      const includeSelections = {};
      Object.keys(STARTER_INGREDIENTS).forEach(cat => {
        const name = `include-${cat}`;
        includeSelections[cat] = getCheckedValuesByName(name);
      });

      const excludeSelections = getCheckedValuesByName('exclude-category');
      const goalSelections = getCheckedValuesByName('goal-tag');

      return { includeSelections, excludeSelections, goalSelections };
    }

    function buildPreviewText({ includeSelections, excludeSelections, goalSelections }) {
      const includedSummary = Object.entries(includeSelections)
        .map(([cat, items]) => items.length ? `${cat}: ${items.join(', ')}` : '')
        .filter(Boolean)
        .join('; ');

      const parts = [];

      if (includedSummary) {
        parts.push(`Include these ingredients and categories: ${includedSummary}.`);
      } else {
        parts.push('No specific ingredients selected yet.');
      }

      if (excludeSelections.length) {
        parts.push(`Avoid these patterns or categories: ${excludeSelections.join(', ')}.`);
      }

      if (goalSelections.length) {
        parts.push(`Emphasize these goals: ${goalSelections.join('; ')}.`);
      }

      if (!excludeSelections.length && !goalSelections.length) {
        parts.push('You can also choose goals or exclusions to better tailor coaching and brain health support.');
      }

      return parts.join(' ');
    }

    function updatePreview() {
      const form = collectFormState();
      const previewEl = document.getElementById('form-preview');
      if (!previewEl) return;
      previewEl.textContent = buildPreviewText(form);
    }

    // =====================
    // RECIPE GENERATION API
    // =====================
    async function callGenerateAPI(payload) {
      const statusEl = document.getElementById('status');
      if (statusEl) {
        statusEl.textContent = 'Contacting the BrainPreserve engine...';
      }

      try {
        const response = await fetch(CFG.generateEndpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();
        if (!data || !data.recipes || !Array.isArray(data.recipes)) {
          throw new Error('Unexpected response format from server.');
        }

        if (statusEl) {
          statusEl.textContent = '';
        }

        const customOutput = document.getElementById('custom-output');
        const previewOutput = document.getElementById('form-preview');

        if (payload.mode === 'custom' && customOutput) {
          customOutput.textContent = data.recipes.join('\n\n---\n\n');
        } else if (previewOutput) {
          previewOutput.textContent = data.recipes.join('\n\n---\n\n');
        }

        if (data.tablesHtml) {
          const tablesContainer = document.getElementById('bp-nutrition');
          if (tablesContainer) {
            tablesContainer.innerHTML = data.tablesHtml;
          }
        }
      } catch (err) {
        if (statusEl) {
          statusEl.textContent = `Error: ${err.message}`;
        }
      }
    }

    // =====================
    // BUTTON HANDLERS
    // =====================
    function generateFromCustom() {
      const input = document.getElementById('custom-input');
      const numRecipesInput = document.getElementById('num-recipes');
      const text = (input && input.value || '').trim();

      const numRequested = numRecipesInput && numRecipesInput.value
        ? parseInt(numRecipesInput.value, 10)
        : undefined;

      const payload = {
        mode: 'custom',
        customText: text || null,
        numRecipes: Number.isFinite(numRequested) ? numRequested : null
      };

      callGenerateAPI(payload);
    }

    function generateFromSelections() {
      const { includeSelections, excludeSelections, goalSelections } = collectFormState();

      const payload = {
        mode: 'selections',
        includeSelections,
        excludeSelections,
        goalSelections
      };

      callGenerateAPI(payload);
    }

    function clearCustomSection() {
      const input = document.getElementById('custom-input');
      const numRecipes = document.getElementById('num-recipes');
      const output = document.getElementById('custom-output');

      if (input) input.value = '';
      if (numRecipes) numRecipes.value = '';
      if (output) output.textContent = '';
    }

    function clearFormSelections() {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      updatePreview();
    }

    // =====================
    // INITIALIZE ON LOAD
    // =====================
    document.addEventListener('DOMContentLoaded', () => {
      buildIncludeUI();
      buildExcludeUI();
      buildGoalsUI();

      ['include-root', 'exc-categories', 'goals'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('change', () => {
            const form = collectFormState();
            document.getElementById('form-preview').textContent = buildPreviewText(form);
          });
        }
      });
    })();

    // Export handlers
    window.generateFromSelections = generateFromSelections;
    window.generateFromCustom     = generateFromCustom;
    window.clearFormSelections    = clearFormSelections;
    window.clearCustomSection     = clearCustomSection;
    window.toggleAccordion        = toggleAccordion;
  </script>
</body>
</html>
